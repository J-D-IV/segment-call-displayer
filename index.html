<!DOCTYPE html>
<html lang="en">
  <script>

  </script>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="https://d1gi394wp2tyv2.cloudfront.net/app/hashed-v6.1/favicons.7ef7549fdbe37dc99365241b5b70794f82f37f9aecf98af84727bb7f7cfeb744/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="https://d1gi394wp2tyv2.cloudfront.net/app/hashed-v6.1/favicons.7ef7549fdbe37dc99365241b5b70794f82f37f9aecf98af84727bb7f7cfeb744/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="48x48" href="https://d1gi394wp2tyv2.cloudfront.net/app/hashed-v6.1/favicons.7ef7549fdbe37dc99365241b5b70794f82f37f9aecf98af84727bb7f7cfeb744/favicon-48x48.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://d1gi394wp2tyv2.cloudfront.net/app/hashed-v6.1/favicons.7ef7549fdbe37dc99365241b5b70794f82f37f9aecf98af84727bb7f7cfeb744/favicon-32x32.png">
  <style type="text/css">

    #container {
      width: 100%;
      align-items: center;
      display: flex;
      justify-content: center;
      flex-direction: column;
    }

    #inputContainer {
      display: flex;
      margin-bottom: 10px;
      flex-direction: column;
    }

    #titleContainer {
      height: auto;
      margin: auto;
    }

    #segmentTitle {
      font-size: 28px;
      margin: 15px;
    }

    #segmentInput {
      width: 400px;
      height: 30px;
      margin-right: 5px;
      text-align: center;
      font-size: 14px;
      margin-bottom: 5px;
    }

    #segmentButton {
      width: 100px;
      height: 36px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #segmentButton:hover {
      background-color: rgb(224, 224, 224);
    }

    .buttonText {
      font-weight: 700;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .buttonTextCompare {
      font-weight: 900;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    table {
      border-collapse: collapse;
      margin: 10px auto;
      font-size: 0.9em;
      font-family: sans-serif;
      min-width: 45vw;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.15),0 0 20px rgba(0, 0, 0, 0.15);
      text-overflow: clip;
      max-width: 45vw;
      height: fit-content;
      margin: 10px;
    }

    table thead tr {
      background-color: #009879;
      color: #ffffff;
      text-align: left;
    }

    table th,
    table td {
      padding: 12px 15px;
      max-width: 5vw;
    }

    table tbody tr {
      border-bottom: 1px solid #dddddd;
    }

    table tbody tr:nth-of-type(even) {
      background-color: #f3f3f3;
    }

    table tbody tr:last-of-type {
      border-bottom: 2px solid #009879;
    }

    table tbody tr.active-row {
      font-weight: bold;
      color: #009879;
    }

    th {
      text-align: inherit;
    }

    td {
      text-overflow: clip;
      overflow: overlay;
    }

    tbody {
      border: 5px solid white;
    }

    thead {
      background-color: grey;
      color: white;
      font-size: 16px;
      border: 5px solid white;
    }

    .hidden {
      display: none;
    }

    tr th {
      background-color: lightblue;
    }

    tr {
      background-color: white;
    }

    #segmentButtonCompare {
      width: 100%;
      height: 40px;
    }

    #segmentButtonCompare:hover {
      background-color: rgb(224, 224, 224);
    }

    #segmentButtonReset {
      width: 100%;
      height: 40px;
      background-color: rgb(251, 190, 190);
    }

    #segmentButtonReset:hover {
      background-color: rgb(255, 128, 128);
    }

    #tableContainer {
      margin-top: 10px;
      border: solid 2px white;
      outline: solid 6px rgb(11, 83, 108);
      background-color: grey;
      display: none;
    }

    .keySpanText {
      height: 30px;
      width: auto;
      display: flex;
      align-items: center;
    }

    .keySpanImg {
      height: 15px;
      width: 50px;
      border: 2px solid black;
    }

    #tableKeyContainer {
      flex-direction: column;
      align-items: center;
    }

  </style>
  <title>Segment Compare</title>
</head>
  <body id="body">
    <div id="container">
      <div id="titleContainer">
        <h3 id="segmentTitle">
          Segment Call Display & Compare
        </h3>
      </div>
      <div id="inputContainer">

        <div style="display: flex;">
          <input placeholder="Paste copied object version of your Segment network call here!" oninput="updateInput(this.value)" id="segmentInput" name="segmentInput" required type="text">
          <button id="segmentButton" onclick="displaySortedTable()"><span class="buttonText">Create</span> <span class="buttonText">Table</span></button>
        </div>
        
        <div style="display: flex;">
          <input placeholder="Paste copied object version of your Segment network call here!" oninput="updateInput(this.value)" id="segmentInput" name="segmentInput2" required type="text">
          <button id="segmentButton" onclick="displaySortedTable()"><span class="buttonText">Create</span> <span class="buttonText">Table</span></button>
        </div>
        <button id="segmentButtonCompare" onclick="compareObjects()" ><span class="buttonTextCompare">Compare</span> <span class="buttonTextCompare">Objects</span></button>
        <button id="segmentButtonReset" onclick="revertPage()" ><span class="buttonTextCompare">Revert</span> <span class="buttonTextCompare">Page</span></button>
      
      <div id="tableKeyContainer" style="display:none; margin-top: 5px;">
        <div style="display:flex;">
          <span class="keySpanImg" style="background-color: rgb(226 203 255); margin-right: 5px; margin-top: 5px;">
          </span>
          <span class="keySpanText">
            = difference between compared values
          </span>
        </div>
      
        <div style="display:flex;">
          <span class="keySpanImg" style="background-color: #faffbd; margin-left: 5px; margin-right: 5px; margin-top: 5px;">
          </span>
          <span class="keySpanText">
            = unique value found in object
          </span>
        </div>
      </div>

    </div>

    <div id="tableContainer">

    </div>
  </div>


    <script>
    function displaySortedTable(jsonObject) {
      let newObj
      let isSingleTable = false
      try {
        if (jsonObject){
          newObj = JSON.stringify(jsonObject)
          newObj = newObj.replaceAll(' ','');
          newObj = JSON.parse(newObj)
        } else {
          newObj = document.getElementById('segmentInput').value;
          newObj = newObj.replaceAll(' ','');
          newObj = JSON.parse(newObj)
          isSingleTable = true;
        }
      } catch (err) {}
      

      const flattenObject = (obj, prefix = '') => {
        return Object.keys(obj).reduce((acc, k) => {
          const pre = prefix.length ? prefix + '.' : '';
          if (typeof obj[k] === 'object' && obj[k] !== null && !Array.isArray(obj[k])) {
            Object.assign(acc, flattenObject(obj[k], pre + k));
          } else {
            acc[pre + k] = obj[k];
          }
          return acc;
        }, {});
      };
      const flattened = flattenObject(newObj);
      // Convert flattened object to an array
      const array = Object.entries(flattened);
      // Sort array by key name
      array.sort((a, b) => a[0].localeCompare(b[0]));
      let table = {}
      for (let i = 0; i < array.length; i += 2){
        let newArr = [array[i], array[i + 1]];
        newArr.forEach((item, index) => {
          try {
            if (item[0]){
              let value = item[1];
              if (Array.isArray(value)) {
                value = value.map((val) => {
                  if (typeof val === 'object' && val !== null && !Array.isArray(val)) {
                    return JSON.stringify(val);
                  } else {
                    return val;
                  }
                });
                value = JSON.stringify(value);
              } else if (typeof value === 'object' && value !== null) {
                value = JSON.stringify(value);
              }
                table[item[0]] = value
              }
            } catch (err) {}
        });
      }
      let returnTable = createNestedTable(table);
      document.getElementById('tableKeyContainer').style.display = 'flex';
      if (isSingleTable === false){
        document.getElementById('tableContainer').style.display = 'flex';
        document.getElementById('tableContainer').appendChild(returnTable)
      } else {
        document.getElementById('tableContainer').style.display = 'flex';
        document.getElementById('tableContainer').after(returnTable)
      }
    }
    let tableNum = "1"
    function createNestedTable(obj) {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const theadTr = document.createElement("tr");
      thead.appendChild(theadTr);
      const theadTh = document.createElement("th");
      theadTh.textContent = 'Object ' + tableNum
      theadTr.appendChild(theadTh)
      const theadTh2 = document.createElement("th");
      theadTr.appendChild(theadTh2)

      table.appendChild(thead);
      try {
        if (tableNum === "1"){
          table.className = "table" + tableNum;
          table.title = "table" + tableNum;
          tableNum = 2;
        } else {
          table.title = "table" + tableNum;
        }
      } catch (err) {}

      const tbody = document.createElement("tbody");
      table.appendChild(tbody);

      const rows = Object.entries(obj);
      rows.sort(([a], [b]) => a.localeCompare(b));

      let currentGroup = "";
      let currentGroupHeader = null;

      for (const [key, value] of rows) {
        const parts = key.split(".");
        const group = parts[0];

        if (group !== currentGroup) {
          currentGroup = group;
          const tr = document.createElement("tr");
          const th = document.createElement("th");
          th.setAttribute("colspan", "2");
          th.textContent = group + '  +';
          th.addEventListener("click", (e) => {
            let added = false;
            if (e.target.innerText.indexOf('+') > - 1){
              e.target.innerText = e.target.innerText.replace('+','-')
              e.target.style = "background-color: rgb(11 83 108); color: white;"
              added = true;
            } 
            if (e.target.innerText.indexOf('-') > -1 && added == false) {
              e.target.innerText = e.target.innerText.replace('-','+')
              e.target.style = "background-color: lightblue; color: black;"
            }
            tbody.querySelectorAll(`tr.${group}`).forEach((row) => {
              row.classList.toggle("hidden");
            });
          });
          tr.appendChild(th);
          tbody.appendChild(tr);

          currentGroupHeader = th;
        }

        const tr = document.createElement("tr");
        tr.classList.add(group, "hidden");
        tbody.appendChild(tr);

        const td1 = document.createElement("td");
        td1.textContent = parts.slice(1).join(".");
        tr.appendChild(td1);

        const td2 = document.createElement("td");
        td2.textContent = value;
        if (td2.textContent.indexOf('diff') > -1){
          td2.style.backgroundColor = "rgb(226 203 255)"
          td2.textContent = td2.textContent.replaceAll('diff','')
        }

        if (td2.textContent.indexOf('unique') > -1){
          td2.style.backgroundColor = "#faffbd"
          td2.textContent = td2.textContent.replaceAll('unique','')
        }
        tr.appendChild(td2);

        if (currentGroupHeader && tr.classList.contains("hidden")) {
          currentGroupHeader.classList.add("collapsible");
        }
      }
      return table;
    }

    function updateInput(value){
      value.trim();
      let retVal = value.replaceAll(' ', '');
      document.getElementById('segmentButton').value = retVal;
    }

    function compareObjects() {
      let obj1 = JSON.parse(document.querySelector('input[name="segmentInput"]').value)
      let obj2 = JSON.parse(document.querySelector('input[name="segmentInput2"]').value)

      // Check for key-value pairs in obj1 that are not in obj2
      for (let key in obj1) {
        if (!obj2.hasOwnProperty(key)) {
          obj1[key] = obj1[key] + ' unique';
        }
      }
      // Check for key-value pairs in obj1 that are not in obj2
      for (let key in obj2) {
        if (!obj1.hasOwnProperty(key)) {
          obj2[key] = obj2[key] + ' unique';
        }
      }
      // Compare key-value pairs in obj2 against obj1
      for (let key in obj2) {
        if (obj1[key] !== obj2[key] &&
            obj2[key].indexOf('unique') == -1) {
          obj2[key] = obj2[key] + ' diff';
        }
      }
      // Compare key-value pairs in obj1 against obj2
      for (let key in obj1) {
        if (obj2[key] !== obj1[key] &&
            obj1[key].indexOf('unique') == -1) {
          obj1[key] = obj1[key] + ' diff';
        }
      }
      displaySortedTable(obj1)
      displaySortedTable(obj2)
    }

    function revertPage(){
      const startingBody = `
        <div id="container">
          <div id="titleContainer">
            <h3 id="segmentTitle">
              Segment Call Display & Compare
            </h3>
          </div>
          <div id="inputContainer">

            <div style="display: flex;">
              <input placeholder="Paste copied object version of your Segment network call here!" oninput="updateInput(this.value)" id="segmentInput" name="segmentInput" required type="text">
              <button id="segmentButton" onclick="displaySortedTable()"><span class="buttonText">Create</span> <span class="buttonText">Table</span></button>
            </div>
            
            <div style="display: flex;">
              <input placeholder="Paste copied object version of your Segment network call here!" oninput="updateInput(this.value)" id="segmentInput" name="segmentInput2" required type="text">
              <button id="segmentButton" onclick="displaySortedTable()"><span class="buttonText">Create</span> <span class="buttonText">Table</span></button>
            </div>
            <button id="segmentButtonCompare" onclick="compareObjects()" ><span class="buttonTextCompare">Compare</span> <span class="buttonTextCompare">Objects</span></button>
            <button id="segmentButtonReset" onclick="revertPage()" ><span class="buttonTextCompare">Revert</span> <span class="buttonTextCompare">Page</span></button>
          
          <div id="tableKeyContainer" style="display:none; margin-top: 5px;">
            <div style="display:flex;">
              <span class="keySpanImg" style="background-color: rgb(226 203 255); margin-right: 5px; margin-top: 5px;">
              </span>
              <span class="keySpanText">
                = difference between compared values
              </span>
            </div>
          
            <div style="display:flex;">
              <span class="keySpanImg" style="background-color: #faffbd; margin-left: 5px; margin-right: 5px; margin-top: 5px;">
              </span>
              <span class="keySpanText">
                = unique value found in object
              </span>
            </div>
          </div>

        </div>

        <div id="tableContainer">

        </div>
      `
      document.getElementsByTagName('body')[0].innerHTML = startingBody
    }

    </script>

  </body>
</html>
